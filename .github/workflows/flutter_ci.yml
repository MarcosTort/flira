# .github/workflows/pr-review-selfhosted.yml
name: AI PR Review (Self-hosted)

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  ai-review:
    runs-on: self-hosted  # Tu mÃ¡quina local
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: Setup Python Environment
      run: |
        # Activar entorno virtual existente
        source ~/ai-review-env/bin/activate
        echo "VIRTUAL_ENV=$VIRTUAL_ENV" >> $GITHUB_ENV
        echo "$VIRTUAL_ENV/bin" >> $GITHUB_PATH
        
    - name: Run AI Code Review
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        PR_NUMBER: ${{ github.event.number }}
        REPO_NAME: ${{ github.repository }}
        BASE_SHA: ${{ github.event.pull_request.base.sha }}
        HEAD_SHA: ${{ github.event.pull_request.head.sha }}
        MODEL_PATH: "/home/user/models/llama-2-7b-chat"  # Ruta local del modelo
      run: python scripts/local_ai_review.py